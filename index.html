<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CheroMarketApp 3.0 PRO ðŸ‡¸ðŸ‡»</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
:root{
  --azul:#0047AB;
  --naranja:#FF8C00;
  --verde:#25D366;
  --rojo:#c62828;
  --fondo:#f4f6f9;
  --card:#ffffff;
  --texto:#333;
  --borde:#ddd;
}

body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:var(--fondo);
  color:var(--texto);
}

header{
  background:white;
  border-bottom:3px solid var(--azul);
  padding:15px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:50;
}

h1{
  margin:0;
  color:var(--azul);
}

.sub{
  font-size:13px;
  color:#777;
}

.buscador{
  margin-top:10px;
  display:flex;
  gap:8px;
  max-width:500px;
  margin-left:auto;
  margin-right:auto;
}

.buscador input{
  flex:1;
  padding:10px;
  border-radius:25px;
  border:1px solid var(--borde);
}

.feed{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:15px;
  padding:15px;
  max-width:1100px;
  margin:auto;
}

.card{
  background:var(--card);
  border-radius:12px;
  border:1px solid var(--borde);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:0.2s;
  position:relative;
}

.card:hover{
  transform:translateY(-5px);
  box-shadow:0 8px 20px rgba(0,0,0,0.15);
}

.card img{
  width:100%;
  height:170px;
  object-fit:cover;
}

.info{
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:4px;
  flex:1;
}

.titulo{
  font-weight:600;
  font-size:15px;
}

.precio{
  color:var(--naranja);
  font-weight:bold;
  font-size:18px;
}

.tag{
  font-size:10px;
  padding:3px 6px;
  border-radius:5px;
  font-weight:bold;
  display:inline-block;
  margin-right:4px;
}

.destacado{
  background:var(--naranja);
  color:white;
}

.verificado{
  background:gold;
  color:black;
}

.btn-wa{
  background:var(--verde);
  color:white;
  text-decoration:none;
  padding:8px;
  border-radius:8px;
  text-align:center;
  margin-top:auto;
  font-weight:bold;
  font-size:13px;
}

.btn-add{
  position:fixed;
  bottom:20px;
  right:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  border:none;
  background:var(--naranja);
  color:white;
  font-size:25px;
  cursor:pointer;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:100;
}

.modal-content{
  background:white;
  padding:20px;
  width:95%;
  max-width:450px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.modal-content input,
.modal-content textarea{
  padding:10px;
  border-radius:8px;
  border:1px solid var(--borde);
}
</style>
</head>
<body>

<header>
  <h1>ðŸ‡¸ðŸ‡» CheroMarketApp 3.0</h1>
  <div class="sub">Marketplace Pro para salvadoreÃ±os</div>

  <div class="buscador">
    <input type="text" id="buscar" placeholder="Â¿QuÃ© buscas?" oninput="filtrar()">
  </div>
</header>

<div class="feed" id="feed"></div>

<button class="btn-add" onclick="abrirModal()">
<i class="fa-solid fa-plus"></i>
</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Nuevo Producto</h3>
    <input id="titulo" placeholder="TÃ­tulo del producto">
    <textarea id="descripcion" placeholder="DescripciÃ³n"></textarea>
    <input id="precio" type="number" placeholder="Precio">
    <input id="telefono" placeholder="WhatsApp">
    <input id="imagen" placeholder="URL de imagen">
    <button onclick="publicar()" style="background:var(--azul);color:white;padding:10px;border:none;border-radius:8px;">Publicar</button>
    <button onclick="cerrarModal()" style="background:none;border:none;">Cancelar</button>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE_BUCKET",
  messagingSenderId: "TU_SENDER_ID",
  appId: "TU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let productosGlobal = [];

async function cargar(){
  const q = query(collection(db,"productos"), orderBy("creado","desc"));
  const snapshot = await getDocs(q);

  productosGlobal = snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));

  render(productosGlobal);
}

function render(lista){
  const feed = document.getElementById("feed");
  feed.innerHTML="";

  // Mostrar destacados primero
  lista.sort((a,b)=> (b.destacado===true)-(a.destacado===true));

  lista.forEach(p=>{

    const card = document.createElement("div");
    card.className="card";

    card.innerHTML = `
      ${p.destacado ? '<span class="tag destacado">ðŸ”¥ Destacado</span>' : ''}
      ${p.verificado ? '<span class="tag verificado">âœ” Verificado</span>' : ''}
      <img src="${p.imagen || 'https://via.placeholder.com/300'}">
      <div class="info">
        <div class="titulo">${p.titulo}</div>
        <div class="precio">$${p.precio}</div>
        <a class="btn-wa" target="_blank"
          href="https://wa.me/503${p.telefono}?text=${encodeURIComponent(
          `Hola, me interesa tu producto "${p.titulo}" publicado en CheroMarketApp ðŸ‡¸ðŸ‡»`
          )}">
          <i class="fa-brands fa-whatsapp"></i> Contactar
        </a>
      </div>
    `;

    feed.appendChild(card);
  });
}

window.publicar = async function(){

  const t = document.getElementById("titulo").value.trim();
  const d = document.getElementById("descripcion").value.trim();
  const p = document.getElementById("precio").value;
  const tel = document.getElementById("telefono").value.trim();
  const img = document.getElementById("imagen").value.trim();

  if(t.length < 5){
    alert("El tÃ­tulo debe tener al menos 5 caracteres.");
    return;
  }

  if(!t || !p || !tel){
    alert("Completa los campos obligatorios.");
    return;
  }

  await addDoc(collection(db,"productos"),{
    titulo:t,
    descripcion:d,
    precio:Number(p),
    telefono:tel,
    imagen:img,
    creado:Date.now(),
    destacado:false,      // listo para monetizar
    verificado:false      // listo para vendedores verificados
  });

  cerrarModal();
  cargar();
};

window.abrirModal = function(){
  document.getElementById("modal").style.display="flex";
};

window.cerrarModal = function(){
  document.getElementById("modal").style.display="none";
};

window.filtrar = function(){
  const texto = document.getElementById("buscar").value.toLowerCase();
  const filtrados = productosGlobal.filter(p =>
    p.titulo.toLowerCase().includes(texto)
  );
  render(filtrados);
};

cargar();
</script>

</body>
</html>
